<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>gh-html</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="frontend.js"></script>
</head>
<body>
<div class="top-bar">
    <div class="dropdown" class "top-bar">
        <button id="repo_change" class="dropbtn">Repo</button>
        <div id="repo_dropdown" class="dropdown-content">
            <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
        </div>
    </div>
</div>
<div class="content">
    <iframe name="git-content" id="git-content" src="welcome.html"></iframe>
</div>
<script>
// Search filter
function repo_filter() {
    var input, filter, ul, li, a, i;
    input = document.getElementById("repo_search");
    filter = input.value.toUpperCase();
    div = document.getElementById("repo_dropdown");
    a = div.getElementsByTagName("a");
    for (i = 0; i < a.length; i++) {
        if (a[i].innerHTML.toUpperCase().indexOf(filter) > -1) {
            a[i].style.display = "";
        } else {
            a[i].style.display = "none";
        }
    }
}
function repo_click(repo) {
    $("#repo_dropdown").hide();
    var url = "./proxy/" + repo + "/gh-html/index.html";
    $('#git-content').attr('src', url);
}
$(function(){
    // Register button handler
    $("#repo_change").click(function(){
        $("#repo_dropdown").toggle();
    });
    // populate repository to dropdown menu
    var frontend = new Frontend();
    frontend.repo_query((success, json) => {
        if (success) {
            var dropdown = $("#repo_dropdown");
            dropdown.empty();
            dropdown.append('<input id="repo_search" type="text" placeholder="Search.." onkeyup="repo_filter()">');
            for (var i in json.repos) {
                var repo = json.repos[i];
                if (repo.fork === false) {
                    dropdown.append('<a target="git-content" href="javascript:repo_click(\'' + repo.name + '\');">' + repo.name + '</a>');
                }
            }
        } else {
            if (json.error == "UNAUTHORIZED") {
                window.location.replace("./gh-oauth");
            } else {
                window.location.replace("./error.html");
            }
        }
    });
});
</script>
</body>
</html>
